# CHECKLIST:
# [ ] RNBW-4855 - ERC20 > ETH
#     - Blockers:
#       - Quotes aren't generating for ETH output swaps
#       - Need to figure out where in the flow it's getting stuck
# [ ] RNBW-4858 - Swap Max button
# [ ] RNBW-4857 - Swaps entry from Discover page
# [ ] RNBW-4856 - Approvals ??? Since were swapping an ERC20 ?
# [ ] RNBW-4861 - Check the viability of Swaps Warnings on Anvil / CI.

# So the flow should look like:
# 1. Maybe look into account impersonation
# 2. Start with DAI on an account were impersonating
# 3. Select DAI as input token VIA Discover page
# 4. Select ETH as output token
# 5. Select Max button
# 6. Check the viability of Swaps Warnings on Anvil / CI.
# 7. Execute Approval + Swap
# 8. Update balance check

appId: ${APP_ID}
tags:
  - wallet
  - parallel
---
- retry:
    maxRetries: 3
    commands:
      - launchApp:
          clearState: true
          clearKeychain: true
          arguments:
            isE2ETest: true
      - runFlow: ../utils/Prepare.yaml
      - runFlow: ../utils/ImportWalletWithKey.yaml

      # Send ETH to test wallet
      - tapOn:
          id: fund-test-wallet-button

      # Connect to Anvil (test network)
      - tapOn:
          id: dev-button-anvil

      # Open swap screen
      - tapOn:
          id: swap-button
      - assertVisible:
          id: swap-screen
      # Select DAI as output token
      - tapOn: 'Find a token to buy'
      - inputText: 'DAI'
      - hideKeyboard
      - tapOn:
          id: token-to-buy-dai-1
      - assertVisible: 'DAI.*'

      # Execute Swap
      - longPressOn:
          id: swap-bottom-action-button
      - runFlow: ../utils/MaybeSetupPin.yaml

      # Update balances
      - retry:
          maxRetries: 3
          commands:
            # On Android, pull to refresh
            - runFlow:
                when:
                  platform: Android
                commands:
                  - swipe:
                      from:
                        id: wallet-screen
                      direction: down
      - tapOn:
          id: 'fast-coin-info'
          index: 1
      - assertVisible:
          id: 'chart-header-Dai'
      - tapOn:
          id: 'swap-action-button'
