appId: ${APP_ID}
tags:
  - browser
  - parallel
---
- launchApp:
    clearState: true
    clearKeychain: true
    arguments:
      isE2ETest: true
- runFlow: ../utils/Prepare.yaml
- runFlow: ../utils/ImportWalletWithKey.yaml

# Navigate to browser
- tapOn:
    id: 'tab-bar-icon-DappBrowserScreen'
- assertVisible:
    id: browser-screen
- runFlow:
    when:
      # Maestro cannot interact with content in webviews on iOS so run
      # the flow only on Android.
      platform: Android
    commands:
      # tap on browser search input
      - tapOn: 'Search or enter website'
      - assertVisible: 'Find apps and more'
      - inputText: 'https://bx-test-dapp.vercel.app/'
      - pressKey: enter
      # tap on wallet pfp to open the control panel
      - tapOn:
          id: account-icon
      - tapOn:
          id: connect-button
        # control panel assertions
      - assertVisible:
          text: '.*BX Test Dapp.*'
      - assertVisible:
          text: 'Disconnect'
      # tap somewhere arbitrary to close the control panel sheet
      - tapOn:
          point: 550, 1000
      - tapOn: 'sign malicious permit'
      - assertVisible: '.*Suspicious Transaction'
